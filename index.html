<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Chat Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- 你原来的样式、字体等 -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,500,600" rel="stylesheet" />

  <style>
    body {
      font-family: 'Source Sans Pro', sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      color: #333;
    }
    .container {
      background: #fff;
      border-radius: 12px;
      padding: 32px;
      margin: 40px 0;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }
    h1 {
      margin-top: 0;
      font-size: 1.75rem;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    input, textarea, select, button {
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    input, select {
      height: 44px;
      padding: 0 12px;
    }
    textarea {
      min-height: 120px;
      padding: 12px;
      resize: vertical;
    }
    button {
      background: #006cff;
      color: #fff;
      border: none;
      height: 50px;
      cursor: pointer;
    }
    button:disabled {
      background: #aacfff;
      cursor: not-allowed;
    }
    /* 美化 chat-output */
    #chat-output {
      background-color: #f9fafb;
      border-radius: 8px;
      padding: 16px;
      min-height: 100px;
      margin-top: 24px;
      white-space: pre-wrap;
      line-height: 1.5;
    }
  </style>

  <!-- i18next -->
  <script src="https://unpkg.com/i18next@21.6.14/dist/umd/i18next.min.js"></script>
</head>
<body>
  <div class="container">
    <h1 data-i18n="title">AI Chat Assistant</h1>
    <!-- 语言选择下拉 -->
    <div style="text-align: right; margin-bottom: 16px;">
      <select id="lang-switch">
        <option value="en">English</option>
        <option value="zh">简体中文</option>
        <!-- 按需再加其它语种 -->
      </select>
    </div>

    <form id="chat-form">
      <input
        id="email"
        type="email"
        placeholder="Enter your email"
        required
        data-i18n="[placeholder]emailPlaceholder"
      />
      <textarea
        id="message"
        placeholder="Type your question"
        required
        data-i18n="[placeholder]messagePlaceholder"
      ></textarea>
      <button id="send-btn" type="submit" data-i18n="sendButton">Send</button>
    </form>

    <div id="chat-output"></div>
  </div>

  <script>
  // 1. 初始化多语言资源
  const resources = {
    en: {
      translation: {
        title: 'AI Chat Assistant',
        emailPlaceholder: 'Enter your email',
        messagePlaceholder: 'Type your question',
        sendButton: 'Send',
        paidNotice: 'Free limit reached, please pay to unlock more.',
        networkError: 'Network error, please try again later.'
      }
    },
    zh: {
      translation: {
        title: 'AI 智能工具平台',
        emailPlaceholder: '请输入你的邮箱',
        messagePlaceholder: '请输入你的问题',
        sendButton: '发送',
        paidNotice: '免费次数已用完，请付费解锁更多次数。',
        networkError: '网络错误，请稍后重试。'
      }
    }
    // …如需覆盖更多语言，按同样格式补充…
  };

  i18next.init({
    lng: 'en',
    resources
  }, () => {
    updateContent();
  });

  // 2. 切换语言
  document.getElementById('lang-switch').addEventListener('change', e => {
    i18next.changeLanguage(e.target.value, updateContent);
  });

  function updateContent() {
    document.querySelectorAll('[data-i18n]').forEach(node => {
      const key = node.getAttribute('data-i18n');
      if (key.includes('[')) {
        // placeholder 或其它属性
        const [attr, path] = key.slice(1,-1).split(']');
        node.setAttribute(attr, i18next.t(path));
      } else {
        node.textContent = i18next.t(key);
      }
    });
  }

  // 3. 拦截表单，AJAX 提交
  document.getElementById('chat-form').addEventListener('submit', async e => {
    e.preventDefault(); // 阻止整页刷新

    const email   = document.getElementById('email').value.trim();
    const message = document.getElementById('message').value.trim();
    const output  = document.getElementById('chat-output');
    const btn     = document.getElementById('send-btn');

    // 清空上次结果，禁用按钮
    output.textContent = '';
    btn.disabled = true;

    try {
      const res = await fetch(
        'https://mute-hall-8386.ljs54leejinsu88888.workers.dev/',  // ← 你的 Worker 域名
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, message })
        }
      );
      const json = await res.json().catch(() => ({}));

      if (!res.ok) {
        // 402、400 或后端付费提示
        output.textContent = json.error || i18next.t('paidNotice');
      } else {
        // 成功回复
        output.textContent = json.reply;
      }
    } catch (err) {
      // 网络异常
      output.textContent = i18next.t('networkError');
    } finally {
      btn.disabled = false;
    }
  });
  </script>
</body>
</html>
